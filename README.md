# فروشگاه کانفیگ V2Ray با پرداخت Plisio و بک‌اند Google Apps Script (آماده برای Firebase App Hosting)

این یک پروژه کامل Next.js برای فروش کانفیگ‌های V2Ray است که از Plisio برای پردازش پرداخت با لایت‌کوین (LTC) و از Google Apps Script به عنوان یک بک‌اند ساده برای مدیریت موجودی و ارسال ایمیل استفاده می‌کند. این نسخه برای دیپلو در **Firebase App Hosting** بهینه‌سازی شده است.

---

## راهنمای راه‌اندازی (Setup)

برای راه‌اندازی کامل این پروژه، لطفاً مراحل زیر را با دقت دنبال کنید.

### مرحله اول: راه‌اندازی بک‌اند با Google Apps Script

بک‌اند این پروژه یک گوگل شیت (Google Sheet) است که توسط یک اسکریپت (Apps Script) مدیریت می‌شود.

**۱. ایجاد گوگل شیت:**
   - یک [گوگل شیت جدید](https://sheets.new) بسازید.
   - در ردیف اول شیت، **دقیقاً** این سه عنوان را برای ستون‌ها وارد کنید:
     - `productName` (در ستون A)
     - `emailBody` (در ستون B)
     - `priceUSD` (در ستون C)

**۲. وارد کردن داده‌ها:**
   - **productName:** نام محصول خود را وارد کنید (مثلاً `V2Ray Config`). اگر این سلول را خالی بگذارید، از مقدار ردیف بالایی استفاده می‌شود.
   - **emailBody:** کانفیگ V2Ray (یا هر متنی که می‌خواهید برای مشتری ایمیل شود) را در این ستون قرار دهید.
   - **priceUSD:** قیمت محصول را به دلار آمریکا و به صورت عدد (مثلاً `2.5`) وارد کنید.

**۳. ایجاد Google Apps Script:**
   - در منوی بالای گوگل شیت، به `Extensions` > `Apps Script` بروید.
   - تمام محتوای فایل `Code.gs` را پاک کرده و کد نهایی و هماهنگ‌شده را که از من دریافت کرده‌اید در آن کپی کنید.

**۴. تنظیم و پابلیش کردن اسکریپت:**
   - **`SPREADSHEET_ID`:** در بالای کد اسکریپت، مقدار `YOUR_SPREADSHEET_ID` را با ID گوگل شیت خودتان جایگزین کنید. (ID را می‌توانید از URL صفحه شیت کپی کنید).
   - **پابلیش (Deploy):**
     - روی دکمه آبی **Deploy** در بالا سمت راست کلیک کرده و **New deployment** را انتخاب کنید.
     - در پنجره باز شده، روی آیکون چرخ‌دنده کنار "Select type" کلیک کرده و **Web app** را انتخاب کنید.
     - در بخش **Who has access**، گزینه **Anyone** را انتخاب کنید.
     - روی **Deploy** کلیک کنید.
     - در اولین بار، گوگل از شما می‌خواهد که دسترسی‌های لازم (برای مدیریت شیت و ارسال ایمیل) را تایید کنید. روی **Authorize access** کلیک کرده و مراحل را دنبال کنید. (ممکن است یک صفحه هشدار "Google hasn't verified this app" نمایش داده شود که باید روی "Advanced" و سپس "Go to (unsafe)" کلیک کنید).
     - پس از اتمام، یک **Web app URL** به شما داده می‌شود. **این URL را کپی کرده و نگه دارید**. این همان `GOOGLE_APPS_SCRIPT_URL` شماست.

### مرحله دوم: راه‌اندازی پروژه برای دیپلو در Firebase

**۱. نصب پیش‌نیازها:**
   - [Node.js](https://nodejs.org/) را نصب کنید.
   - [Firebase CLI](https://firebase.google.com/docs/cli) را با دستور `npm install -g firebase-tools` نصب کنید.

**۲. ورود به حساب گوگل:**
   - در ترمینال خود دستور `firebase login` را اجرا کرده و وارد حساب گوگل خود شوید.

**۳. ایجاد پروژه Firebase:**
   - به [کنسول Firebase](https://console.firebase.google.com/) بروید و یک پروژه جدید بسازید.

**۴. اتصال پروژه محلی به Firebase:**
   - در پوشه اصلی پروژه خود در ترمینال، دستور `firebase init apphosting` را اجرا کنید.
   - CLI از شما می‌خواهد که پروژه‌ای را که در مرحله قبل ساختید، انتخاب کنید.
   - سپس از شما یک نام برای بک‌اند (backend) می‌خواهد (مثلاً `v2ray-store-backend`).
   - پس از اتمام، فایل `firebase.json` و `.firebaserc` در پروژه شما ایجاد می‌شود.

**۵. افزودن متغیرهای محیطی (Environment Variables):**
   - این **مهم‌ترین** مرحله است. شما باید متغیرهای خود را در **Google Cloud Secret Manager** ذخیره کنید.
   - به [صفحه Secret Manager در Google Cloud Console](https://console.cloud.google.com/security/secret-manager) بروید. (مطمئن شوید پروژه صحیح گوگل کلاد که مربوط به پروژه فایربیس شماست، انتخاب شده باشد).
   - سه Secret جدید با نام‌های زیر ایجاد کنید و مقادیر مربوطه را در آن‌ها قرار دهید:
     - `PLISIO_SECRET_KEY`
     - `GOOGLE_APPS_SCRIPT_URL`
     - `NEXT_PUBLIC_APP_URL`
   - **اعطای دسترسی:** پس از ایجاد Secretها، باید به سرویس App Hosting اجازه دسترسی به آن‌ها را بدهید. این کار معمولاً به صورت خودکار انجام می‌شود، اما اگر با خطای دسترسی مواجه شدید، باید نقش `Secret Manager Secret Accessor` را به حساب سرویس App Hosting بدهید.

**۶. دیپلو کردن سایت:**
   - در ترمینال، در پوشه اصلی پروژه، دستور زیر را اجرا کنید:
     ```bash
     firebase apphosting:backends:deploy YOUR_BACKEND_ID
     ```
     (به جای `YOUR_BACKEND_ID`، نامی را که در مرحله ۴ برای بک‌اند انتخاب کردید، قرار دهید).
   - فایربیس شروع به بیلد و دیپلو کردن سایت شما می‌کند. پس از چند دقیقه، سایت شما آماده و آنلاین خواهد بود و URL آن در ترمینال نمایش داده می‌شود.

اکنون سایت شما با موفقیت در Firebase App Hosting دیپلو شده و آماده به کار است!
