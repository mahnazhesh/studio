# فروشگاه کانفیگ V2Ray با پرداخت Plisio و بک‌اند Google Apps Script

این یک پروژه کامل Next.js برای فروش کانفیگ‌های V2Ray است که از Plisio برای پردازش پرداخت با لایت‌کوین (LTC) و از Google Apps Script به عنوان یک بک‌اند ساده برای مدیریت موجودی و ارسال ایمیل استفاده می‌کند.

---

## راهنمای راه‌اندازی (Setup)

برای راه‌اندازی کامل این پروژه، لطفاً مراحل زیر را با دقت دنبال کنید.

### مرحله اول: راه‌اندازی بک‌اند با Google Apps Script

بک‌اند این پروژه یک گوگل شیت (Google Sheet) است که توسط یک اسکریپت (Apps Script) مدیریت می‌شود.

**۱. ایجاد گوگل شیت:**
   - یک [گوگل شیت جدید](https://sheets.new) بسازید.
   - در ردیف اول شیت، **دقیقاً** این سه عنوان را برای ستون‌ها وارد کنید:
     - `productName` (در ستون A)
     - `emailBody` (در ستون B)
     - `priceUSD` (در ستون C)

**۲. وارد کردن داده‌ها:**
   - **productName:** نام محصول خود را وارد کنید (مثلاً `V2Ray Config`). اگر این سلول را خالی بگذارید، از مقدار ردیف بالایی استفاده می‌شود.
   - **emailBody:** کانفیگ V2Ray (یا هر متنی که می‌خواهید برای مشتری ایمیل شود) را در این ستون قرار دهید.
   - **priceUSD:** قیمت محصول را به دلار آمریکا و به صورت عدد (مثلاً `2.5`) وارد کنید.

**۳. ایجاد Google Apps Script:**
   - در منوی بالای گوگل شیت، به `Extensions` > `Apps Script` بروید.
   - تمام محتوای فایل `Code.gs` را پاک کرده و کد نهایی و هماهنگ‌شده را که از من دریافت کرده‌اید در آن کپی کنید.

**۴. تنظیم و پابلیش کردن اسکریپت:**
   - **`SPREADSHEET_ID`:** در بالای کد اسکریپت، مقدار `YOUR_SPREADSHEET_ID` را با ID گوگل شیت خودتان جایگزین کنید. (ID را می‌توانید از URL صفحه شیت کپی کنید).
   - **پابلیش (Deploy):**
     - روی دکمه آبی **Deploy** در بالا سمت راست کلیک کرده و **New deployment** را انتخاب کنید.
     - در پنجره باز شده، روی آیکون چرخ‌دنده کنار "Select type" کلیک کرده و **Web app** را انتخاب کنید.
     - در بخش **Who has access**، گزینه **Anyone** را انتخاب کنید.
     - روی **Deploy** کلیک کنید.
     - در اولین بار، گوگل از شما می‌خواهد که دسترسی‌های لازم (برای مدیریت شیت و ارسال ایمیل) را تایید کنید. روی **Authorize access** کلیک کرده و مراحل را دنبال کنید. (ممکن است یک صفحه هشدار "Google hasn't verified this app" نمایش داده شود که باید روی "Advanced" و سپس "Go to (unsafe)" کلیک کنید).
     - پس از اتمام، یک **Web app URL** به شما داده می‌شود. **این URL را کپی کرده و نگه دارید**. این همان `GOOGLE_APPS_SCRIPT_URL` شماست.

### مرحله دوم: راه‌اندازی پروژه Next.js

**۱. نصب پیش‌نیازها:**
   - [Node.js](https://nodejs.org/) را نصب کنید.
   - با استفاده از ترمینال (Command Prompt یا Terminal) دستور `npm install` را در پوشه اصلی پروژه اجرا کنید تا تمام پکیج‌ها نصب شوند.

**۲. ایجاد فایل متغیرهای محیطی (`.env`):**
   - در پوشه اصلی پروژه، یک فایل جدید به نام `.env` بسازید و مقادیر زیر را در آن قرار دهید.

### مرحله سوم: دیپلو در Netlify

**۱. ایجاد حساب و اتصال به گیت:**
   - در سایت [Netlify.com](https://www.netlify.com/) یک حساب کاربری بسازید.
   - کد پروژه خود را در یک ریپازیتوری گیت (مانند GitHub, GitLab یا Bitbucket) پوش کنید.

**۲. ایمپورت پروژه در Netlify:**
   - در داشبورد Netlify، روی **"Add new site"** کلیک کرده و **"Import an existing project"** را انتخاب کنید.
   - سرویس گیت خود را انتخاب کرده و ریپازیتوری پروژه را پیدا و انتخاب کنید.

**۳. تنظیمات بیلد (Build Settings):**
   - Netlify به صورت هوشمند پروژه شما را به عنوان یک سایت Next.js شناسایی می‌کند و تنظیمات بیلد را به طور خودکار انجام می‌دهد. فایل `netlify.toml` موجود در پروژه این تنظیمات را مدیریت می‌کند و شما نیازی به تغییر چیزی ندارید.

**۴. افزودن متغیرهای محیطی (Environment Variables):**
   - این **مهم‌ترین** مرحله است. در تنظیمات سایت خود در Netlify به بخش `Site configuration` > `Environment variables` بروید.
   - روی **"Add a variable"** کلیک کرده و سه متغیر زیر را با مقادیر واقعی خودتان ایجاد کنید:

     - **`PLISIO_SECRET_KEY`**: کلید محرمانه API از حساب کاربری Plisio شما.
     - **`GOOGLE_APPS_SCRIPT_URL`**: آدرس Web App که از Google Apps Script دریافت کردید.
     - **`NEXT_PUBLIC_APP_URL`**: آدرس کامل و نهایی سایت شما که Netlify به شما می‌دهد (مثلاً `https://your-awesome-site.netlify.app`).

**۵. دیپلو کردن سایت:**
   - روی دکمه **"Deploy site"** (یا "Trigger deploy") کلیک کنید.
   - Netlify شروع به بیلد و دیپلو کردن سایت شما می‌کند. پس از چند دقیقه، سایت شما آماده و آنلاین خواهد بود.

اکنون سایت شما با موفقیت در Netlify دیپلو شده و آماده به کار است!
